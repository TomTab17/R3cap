<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Risultati ricerca</title>
    <link rel="stylesheet" th:href="@{/css/searchResults.css}" />
</head>
<body>
    <h1>Risultati per: "<span th:text="${query}"></span>"</h1>

    <!-- Overlay centrato per nessun risultato -->
    <div class="overlay-message" th:if="${#lists.isEmpty(results)}">
        <p>
            üôÖüèº‚Äç‚ôÇÔ∏è Nessun appunto trovato per la tua ricerca
            <span th:if="${corsoDiStudiSelezionato != null && corsoDiStudiSelezionato != 'Tutti'}">
                nel corso di studi di <span th:text="${corsoDiStudiSelezionato}"></span>
            </span>
            <span th:if="${corsoDiStudiSelezionato == 'Tutti'}">
                in tutti i corsi di studio
            </span>
            <span th:if="${corsoDiStudiSelezionato == null}">
                nel tuo corso di studi di <span th:text="${corsoDiStudiUtente}"></span>
            </span>
        </p>
    </div>

    <div class="results-grid">
        <div th:each="note : ${results}" class="note-card">
            <h2 th:text="${note.title}"></h2>

            <div th:if="${note != null and note.previewImagePath != null}">
                <div class="preview-container">
                    <img th:src="@{${note.previewImagePath}}"
                         th:attr="data-src=@{/previews/${note.previewImagePath}}"
                         alt="Anteprima PDF" class="preview-image"
                         onload="loadImageWithToken(this)" />
                </div>
            </div>

            <p th:text="${note.description}"></p>
            <p th:text="'Caricato da: ' + ${note.uploader.username}"></p>
            <p th:text="'Caricato il: ' + ${#temporals.format(note.uploadDate, 'dd/MM/yyyy HH:mm')}"></p>
            <a th:href="@{'/notes/download/' + ${note.id}}" download class="download-link">üìÑ Scarica</a>

            <!-- üîΩ Sezione voti -->
            <div class="vote-section">
                <form th:action="@{/notes/vote}" method="post">
                    <input type="hidden" name="noteId" th:value="${note.id}" />
                    <input type="hidden" name="value" value="1" />
                    <button type="submit">‚¨Ü</button>
                </form>
                <form th:action="@{/notes/vote}" method="post">
                    <input type="hidden" name="noteId" th:value="${note.id}" />
                    <input type="hidden" name="value" value="-1" />
                    <button type="submit">‚¨á</button>
                </form>
            </div>

            <hr/>
        </div>
    </div>

    <a th:href="@{/}" class="back-link">Torna alla home üè†</a>

    <script>
        // Funzione per caricare l'immagine con il token
        function loadImageWithToken(imageElement) {
            var token = /*[[${_csrf.token}]]*/ ''; // Ottieni il token CSRF da Thymeleaf
            var src = imageElement.getAttribute('data-src'); // Ottieni il percorso dell'immagine

            if (token && src) {
                var img = new Image();
                img.src = src;
                img.onload = function () {
                    imageElement.src = src;
                };
                img.onerror = function () {
                    console.error("Errore nel caricamento dell'immagine.");
                };
            }
        }
    </script>
</body>
</html>
