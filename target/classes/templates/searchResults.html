<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Risultati ricerca</title>
    <link rel="stylesheet" th:href="@{/css/searchResults.css}" />
</head>
<body>
    <h1>Risultati per: "<span th:text="${query}"></span>"</h1>

    <div class="results-grid">
        <div th:if="${#lists.isEmpty(results)}">
            <p class="message">Nessun appunto trovato per la tua ricerca nel tuo corso di studi.</p>
        </div>

        <div th:each="note : ${results}" class="note-card">
            <h2 th:text="${note.title}"></h2>

            <!-- Mostra anteprima se disponibile -->
            <div th:block="note != null and note.previewImagePath != null">
                <div class="preview-container">
                    <!-- Usa data-src per la sorgente dell'immagine -->
                    <img th:src="@{${note.previewImagePath}}" 
                         th:attr="data-src=@{/previews/${note.previewImagePath}}" 
                         alt="Anteprima PDF" class="preview-image" 
                         onload="loadImageWithToken(this)" />
                </div>
            </div>

            <p th:text="${note.description}"></p>
            <p th:text="'Caricato da: ' + ${note.uploader.username}"></p>
            <p th:text="'Caricato il: ' + ${#temporals.format(note.uploadDate, 'dd/MM/yyyy HH:mm')}"></p>
            <a th:href="@{'/notes/download/' + ${note.id}}" download class="download-link">üìÑ Scarica</a>
            <hr/>
        </div>
    </div>

    <a th:href="@{/}" class="back-link">Torna alla home üè†</a>

    <script>
        // Funzione per caricare l'immagine con il token
        function loadImageWithToken(imageElement) {
            var token = /*[[${_csrf.token}]]*/ ''; // Ottieni il token CSRF da Thymeleaf
            var src = imageElement.getAttribute('data-src'); // Ottieni il percorso dell'immagine

            if (token && src) {
                var img = new Image();
                img.src = src;  // Imposta l'URL dell'immagine
                img.onload = function() {
                    imageElement.src = src; // Carica l'immagine una volta che √® stata recuperata
                };
                img.onerror = function() {
                    console.error('Errore nel caricamento dell\'immagine.');
                };
            }
        }
    </script>

</body>
</html>
